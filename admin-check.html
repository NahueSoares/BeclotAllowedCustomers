<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Clientes - Cheque</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f5f5f5; }
    label, select, button { display: block; margin: 1rem 0; }
    .status { font-weight: bold; margin: 1rem 0; }
    .json-output { background: #fff; padding: 1rem; border: 1px solid #ccc; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>Gestión de clientes habilitados para pagar con cheque</h2>

  <label for="customer-select">Seleccionar cliente:</label>
  <select id="customer-select">
    <option value="">-- Selecciona un cliente --</option>
    <option value="3">Cliente 3</option>
    <option value="202">Cliente 202</option>
    <option value="303">Cliente 303</option>
    <option value="404">Cliente 404</option>
  </select>

  <div class="status" id="status"></div>

  <label for="toggle-select">¿Habilitado para pagar con cheque?</label>
  <select id="toggle-select">
    <option value="true">Sí</option>
    <option value="false">No</option>
  </select>

  <button onclick="actualizarLista()">Actualizar</button>

  <h3>Nuevo JSON para reemplazar:</h3>
  <div class="json-output" id="json-output">{}</div>

  <script>
    const GITHUB_JSON_URL = "https://nahuesoares.github.io/BeclotAllowedCustomers/allowed_customers.json";

    let allowedCustomerIDs = [];

    // Cargar lista desde GitHub
    fetch(GITHUB_JSON_URL, { cache: "no-store" })
      .then(res => res.json())
      .then(data => {
        allowedCustomerIDs = data.allowedCustomerIDs || [];
        document.getElementById("json-output").textContent = JSON.stringify({ allowedCustomerIDs }, null, 2);
      });

    // Mostrar estado actual al seleccionar cliente
    document.getElementById("customer-select").addEventListener("change", () => {
      const id = parseInt(document.getElementById("customer-select").value, 10);
      const statusEl = document.getElementById("status");
      if (!id) {
        statusEl.textContent = "";
        return;
      }

      if (allowedCustomerIDs.includes(id)) {
        statusEl.textContent = "Cliente actualmente habilitado para pagar con cheque.";
        document.getElementById("toggle-select").value = "true";
      } else {
        statusEl.textContent = "Cliente actualmente NO habilitado para pagar con cheque.";
        document.getElementById("toggle-select").value = "false";
      }
    });

    // Actualizar la lista local
    function actualizarLista() {
      const id = parseInt(document.getElementById("customer-select").value, 10);
      const habilitado = document.getElementById("toggle-select").value === "true";

      if (!id) {
        alert("Selecciona un cliente.");
        return;
      }

      const index = allowedCustomerIDs.indexOf(id);
      if (habilitado && index === -1) {
        allowedCustomerIDs.push(id);
      } else if (!habilitado && index !== -1) {
        allowedCustomerIDs.splice(index, 1);
      }

      allowedCustomerIDs.sort((a, b) => a - b); // Ordenar por estética
      document.getElementById("json-output").textContent = JSON.stringify({ allowedCustomerIDs }, null, 2);
      document.getElementById("status").textContent = habilitado
        ? "Cliente habilitado para pagar con cheque."
        : "Cliente eliminado de la lista de cheque.";
    }
  </script>

</body>
</html>
