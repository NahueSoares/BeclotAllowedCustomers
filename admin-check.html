<script>
const GITHUB_TOKEN = "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";
const OWNER = "nahuesoares";
const REPO = "BeclotAllowedCustomers";
const FILE_PATH = "allowed_customers.json";
const BRANCH = "main";

// Cargar JSON actual
async function fetchAllowedCustomers() {
  const res = await fetch(`https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${FILE_PATH}`);
  const json = await res.json();
  return json.allowedCustomerIDs;
}

// Guardar cambios
async function updateAllowedCustomers(updatedList) {
  const getUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

  // Obtener SHA actual del archivo
  const getRes = await fetch(getUrl, {
    headers: {
      Authorization: `token ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    }
  });

  const fileData = await getRes.json();
  const sha = fileData.sha;

  // Armar nuevo contenido
  const updatedContent = {
    allowedCustomerIDs: updatedList
  };

  const payload = {
    message: "Actualizar lista de clientes habilitados",
    content: btoa(JSON.stringify(updatedContent, null, 2)), // codificar en base64
    sha: sha,
    branch: BRANCH
  };

  // Enviar actualización
  const updateRes = await fetch(getUrl, {
    method: "PUT",
    headers: {
      Authorization: `token ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    },
    body: JSON.stringify(payload)
  });

  if (updateRes.ok) {
    alert("¡Actualizado correctamente!");
  } else {
    alert("Error al actualizar");
    console.error(await updateRes.json());
  }
}
</script>
